# I/O

## I/O分类

使用特性

1. 人机交互
2. 存储设备
3. 网络通信设备

传输速率：

1. 低速：键盘鼠标
2. 中速：打印机
3. 快速：磁盘

信息交换单位

1. 块设备：存取以数据块为单位、传输速率高、可寻址、随机读写
2. 字符设备：无结构类型、不可以寻址、输入输出一般采用中断方式

## I/O控制方式

1. 程序直接控制方式：需要CPU轮询，CPU与I/O串行，效率低
2. 中断驱动方式：每一条指令周期的结束，CPU检查中断判断有咩有中断需求
3. DMA方式：
   1. 基本的数据单位是块
   2. I/O直接与内存联系
   3. 传送开始和结束需要CPU，中间仅需要DMA控制器，但仍需要CPU控制数据块的大小与传送的位置
      1. 命令/状态寄存器：接受CPU发来的I/O命令或者I/O状态的信息
      2. 内存地址寄存器
      3. 数据寄存器
      4. 数据计数器：存放要传送的字节数目
4. 通道方式：对一个数据块的读写升级为对一组数据块的读写
   1. 通道是简化的处理机，可以执行指令但是咩有内存，和CPU一起共享内存

### I/O子系统

1. 用户层软件：与用户进行交互的接口
2. 设备独立性软件：独立于具体的物理设备，引入了逻辑设备。负责设备、保护、分配、释放。管理数据传送空间
   1. 执行共有操作：设备分配回收、逻辑设备到物理设备映射、缓冲管理、差错控制、设备保护
   2. 向用户层提供统一接口
3. 设备驱动程序：与硬件直接相关，**计算对应的物理地址位置**
4. 中断处理程序：保存被中断进程的CPU环境，应当存放到OS的底层
5. 硬件：设备控制器
   1. 功能
      1. 接受识别CPU或者通道发来的命令
      2. 实现数据交换
      3. 发现和记录设备以及自身的状态
      4. 设备地址识别
   2. 组成
      1. 与CPU的接口
      2. 与设备的接口
      3. I/O控制逻辑：**实现对于设备的控制**

## I/O核心子系统

解决I/O种类繁多、功能、传输速率差别大的问题

提供服务：

1. I/O调度
2. 缓冲与高速缓存
3. 设备分配与回收
4. 假脱机
5. 设备保护
6. 差错处理

### I/O调度

类似于磁盘调度算法

### 缓冲区

缓解CPU与I/O不匹配、数据粒度不同的问题、减少了对CPU的中断频率、提高了CPU与I/O的并行性

实现方法：

1. 硬件缓冲区（成本高）
2. 内存缓冲区：非空不可以写，非满不可以读
   1. 单缓冲
   2. 双缓冲：提高了CPU与I/O的并行性
   3. 循环缓冲区
   4. 缓冲池：
      1. 队列
         1. 空缓冲队列
         2. 输入队列（装满了数据）
         3. 输出队列（装满了数据）
      2. 缓冲区
         1. 收容输入数据的工作缓冲区
         2. 收容输出数据的工作缓冲区
         3. 提取输入数据的工作缓冲区：输入队列
         4. 提取输出数据的工作缓冲区：输出队列

### 设备分配与回收

1. 独占设备：只可以被一个进程所占有使用
2. 分享式共享设备：每一个进程分时共享I/O设备
3. SPOOLing技术：空间换取时间的操作

#### 分配方式

1. 静态分配：安全但是效率低
2. 动态分配：效率高但是可能死锁

#### 设备分配安全性

1. 安全分配方式：进程提出了I/O请求之后，表进入阻塞状态，直到I/O请求被满足。这样使得CPU与I/O串行工作
2. 不安全分配方式：进程提出了I/O请求之后，可以继续往下运行

### 设备分配的数据结构

1. DCT：一个设备对应一个，里面的内容描述了设备的各个属性
   1. 设备类型、状态、标识符
   2. 指向COCT的指针
   3. 设备队列队首指针
   4. 重复执行的时间或者次数
2. COCT：控制器控制表，与DCT一一对应
   1. 控制器表示符
   2. 控制器状态
   3. 通道表指针
   4. 控制器队首、队尾指针
3. CHCT：通道控制表，与COCT一多对应
   1. 通道标识符
   2. 通道状态
   3. 与通道连接的控制器首址
   4. 队首、队尾指针
4. SDT：系统设备表，一个OS仅一个，每一个设备占据一个表项
   1. 设备类
   2. 设备标识符
   3. DCT
   4. 驱动程序入口

### SPOOLing技术

1. 输入输出井
2. 输入输出磁盘缓冲区（内存）