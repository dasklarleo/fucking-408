# 存储系统

## 基础知识

### 存储器分类

1. 作用
   1. 主存
   2. 辅助存储
   3. cache
2. 介质
   1. RAM：SRAM、DRAM
      1. SRAM：速度快、集成差、能耗高、非破坏读出。一般用作cache
      2. DRAM：速度慢、集成好、能耗低、破坏读出，一般用作主存
   2. ROM：
   3. 串行访问存储器：磁带、**磁盘**
3. 信息可保存性
   1. 易失性存储器
   2. 非易失性存储器

### 存储器结构

1. CPU
2. 寄存器
3. 主存
4. 磁盘

### DRAM

tips：采用电荷存储信息

1. **采用地址复用技术，地址线只需要取1/2，其他需要的线有片选线、读写控制线、行列有效线，注意分清多个芯片组成一个存储器时片选线和地址线的区别**
2. 需要进行刷新，刷新时以行为单位
   1. 集中刷新：一个周期内采用一个固定时间进行刷新
   2. 分散刷新：对于每行的刷新分散到每一个读写周期之中，这样会增大系统的存取周期，降低系统的速度
   3. 一部刷新：刷新周期/行数，每过这样一段时间产生一次刷新请求
   4. 译码阶段刷新：透明刷新

### ROM

1. MROM
2. PROM
3. EPROM
4. **FLASH-ROM**
5. **固态硬盘**

## 主存与CPU连接

### 拓展方式

字位拓展

### 选片

线选与译码选片

## 多模块存储器

### 单体多字

一个存储体，但是存储单元有多个存储字，一次性可以读取m条指令，然后每隔1/m个存取周期向CPU发送

但是不适用于跳转指令，仅可以应用于连续存放

### 多体并行

存储器由多个存储模块组成，可以分为高位交叉编址和低位交叉编址

1. 高位交叉编址：一个存储体用完之后才可以在另一个存储体存数据，因此不可以提高吞吐率
2. 低位交叉编址：低位为体号，高位为体内编址。这样可以在不改变系统的存取周期下通过流水的方式提高系统的吞吐率

流水：由m个模块，总线传送周期为r，存取周期为T。那么应该：**m>=T/r**

连续传输m个字耗费的时间：t=T+(m-1)r

## cache

### 与主存的映射方式：

1. 直接映射：主存之中的某一块只可以装入到cache之中的唯一一块的地址
   1. 地址结构：标记		cache行号		 块内地址
   2. 步骤：先获得地址的cache行号，然后再判断标记是否一样；不一样：换出、一样：读写数据

1. 全相联映射：内存之中的每一块都可以映射到cache之中的某一行，但是需要和每一块标记进行比较
   1. 地址结构：标记								  块内地址
   2. 步骤：找标记
2. 组相联映射：cache分为若干个大小相同的组，主存的一个数据块可以存放到组内的任何位置，每一组的行数称作为路数
   1. 地址结构：标记		cache组号		块内地址
   2. 步骤：直到组号，再寻找标记

### 替换算法：

1. RAND
2. FIFO
3. LFU
4. LRU
   1. 命中时，计数器清零，比其低的计数器+1，其余不变
   2. 未命中并且由空闲行的时候，新装入的计数器为0，其余+1
   3. 未命中没有空闲行：选一个最大的淘汰，新装入的计数器为0

### 写策略

1. 写命中
   1. 全写法（写直通法）：CPU将数据同时写入cache和主存，这样可以保证数据的准确性，但是会让效率降低
   2. 写回法：先修改cache的内容，只有当cache被换出的时候才修改主存对应的内容
2. 写不命中
   1. 写分配：从主存读到cache之中，修改cache
   2. 非写分配：直接修改主存

## 虚拟存储器

与OS类似，不再阐述